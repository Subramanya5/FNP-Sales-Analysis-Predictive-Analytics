CREATE DATABASE fnp_sales;
USE fnp_sales;
CREATE TABLE customers (
    Customer_ID INT NOT NULL,
    Name VARCHAR(100),
    City VARCHAR(100),
    Contact_Number VARCHAR(20),
    Email VARCHAR(100),
    Gender VARCHAR(10),
    Address VARCHAR(255),
    PRIMARY KEY (Customer_ID)
) ENGINE=InnoDB;
CREATE TABLE products (
    Product_ID INT NOT NULL,
    Product_Name VARCHAR(150),
    Category VARCHAR(100),
    Price_INR DECIMAL(10,2),
    Occasion VARCHAR(100),
    Description TEXT,
    PRIMARY KEY (Product_ID)
) ENGINE=InnoDB;
CREATE TABLE orders (
    Order_ID INT NOT NULL,
    Customer_ID INT NOT NULL,
    Product_ID INT NOT NULL,
    Quantity INT,
    Order_Date DATE,
    Order_Time TIME,
    Delivery_Date DATE,
    Delivery_Time TIME,
    Location VARCHAR(100),
    Occasion VARCHAR(100),
    MonthName VARCHAR(20),
    Hour INT,
    Diff_Order_Delivery INT,
    Price_INR DECIMAL(10,2),
    Revenue DECIMAL(12,2),
    Delivery_Day VARCHAR(20),
    
    PRIMARY KEY (Order_ID),
    
    FOREIGN KEY (Customer_ID)
        REFERENCES customers(Customer_ID)
        ON DELETE CASCADE
        ON UPDATE CASCADE,

    FOREIGN KEY (Product_ID)
        REFERENCES products(Product_ID)
        ON DELETE CASCADE
        ON UPDATE CASCADE
) ENGINE=InnoDB;

#Total Revenue
SELECT SUM(Revenue) AS Total_Revenue FROM orders;

#Total Orders
SELECT COUNT(Order_ID) AS Total_Orders FROM orders;

#Top-selling products
SELECT p.Product_Name, SUM(o.Quantity) AS Total_Qty
FROM orders o
JOIN products p ON o.Product_ID = p.Product_ID
GROUP BY p.Product_Name
ORDER BY Total_Qty DESC;

#Monthly Revenue
SELECT MonthName, SUM(Revenue) AS Monthly_Revenue
FROM orders
GROUP BY MonthName;

#Average Delivery Time
SELECT AVG(Diff_Order_Delivery) AS Avg_Delivery_Time
FROM orders;

#Revenue by City
SELECT Location AS City, SUM(Revenue) AS Revenue
FROM orders
GROUP BY City
ORDER BY Revenue DESC;

#Orders by Occasion
SELECT Occasion, COUNT(*) AS Total_Orders
FROM orders
GROUP BY Occasion;

#Customer Segmentation Base
SELECT 
    o.Customer_ID,
    COUNT(o.Order_ID) AS Total_Orders,
    SUM(o.Revenue) AS Total_Spend,
    AVG(o.Quantity) AS Avg_Quantity,
    AVG(o.Diff_Order_Delivery) AS Avg_Delivery_Time
FROM orders o
GROUP BY o.Customer_ID;

# Time-series dataset for Sales Forecasting
SELECT 
    Order_Date,
    SUM(Revenue) AS Daily_Revenue
FROM orders
GROUP BY Order_Date
ORDER BY Order_Date;

#Product Demand Prediction Dataset
SELECT 
    Order_Date,
    Product_ID,
    SUM(Quantity) AS Total_Demand
FROM orders
GROUP BY Order_Date, Product_ID
ORDER BY Order_Date;

#Delivery Time Prediction Dataset
SELECT 
    Quantity,
    Hour,
    MonthName,
    Occasion,
    Diff_Order_Delivery AS Delivery_Days
FROM orders;

#Location-wise Delivery Performance
SELECT 
    Location,
    AVG(Diff_Order_Delivery) AS Avg_Delivery_Days
FROM orders
GROUP BY Location
ORDER BY Avg_Delivery_Days DESC;

#Occasion-wise Spending Analysis
SELECT 
    Occasion,
    SUM(Revenue) AS Total_Revenue,
    AVG(Diff_Order_Delivery) AS Avg_Delivery_Days
FROM orders
GROUP BY Occasion;

#Customer RFM Model
SELECT 
    Customer_ID,
    DATEDIFF(CURDATE(), MAX(Order_Date)) AS Recency,
    COUNT(Order_ID) AS Frequency,
    SUM(Revenue) AS Monetary
FROM orders
GROUP BY Customer_ID;
